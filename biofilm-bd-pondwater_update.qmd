---
title: "Biofilm Bd Update"
author: "Caitlin Nordheim-Maestas"
format:
  html:
    toc: true
    code-fold: true
    toc-location: left
---

# To-do list/ meeting notes from 2/16/24 meeting:

Part I "15 sites pond water": Done

- We are using TOTAL Bd for part I
- Update barplot: side by side barplot with colors, update labels to pond water with and without microbes, order by site by park to keep consistent across plots
- Visualize a boxplot version too
- Visualize a scatterplot too: day 1 v day 7, color by filter

Part II: "Nine sites field biofilm"

- Biofilm only for analysis, but keep all data in the plot
- Stats: this is a randomized block design, so stats accordingly: zsp~ day + site as a random effect
- Went back and forth on color, I think the final consensus was that biofilm is dark grey and supernatant is lighter gray

Part III: Monolayer-Bd biofilm: Done

- Cut the 15 sites supernatant only experiment
- Use total Bd
- Paired ttest on the difference

Part IV: Cross-experiment comparisons: Is a monolayer biofilm a better inhibitor compared to microbes alone?
- 1: susbet out only nine sites
- 2: calculate the percent Bd lost from day 1 to day 7 per site
- 3: add column for monolayer biofilm or no biofilm
- 4: diff ~ type
- Or just plot them 

Part V: Cross-experiment comparisons: Is a field biofilm a better inhibitor compared to microbes alone?
- 1: susbet out only nine sites and nly 40 micron filtered from part1
- 2: calculate the percent Bd lost from day 1 to day 7 per site
- 3: add column for field biofilm or no biofilm
- 4: diff ~ type
- Or just plot them

```{r}
#| warning: false

## read in and clean data
library(tidyverse) # for cleaning and viewing data
library(here) # for importing data
library(ggpubr)
library(rstatix)
library(ggplot2)
library(car)
library(multcomp)
library(nlme)

ns_biofilm_bd <- read.csv(here("data", "nine-sites-biofilm-on-Bd - Sheet1.csv"))
fs_pw_bd <- read.csv(here("data", "fifteen-sites-PW-on-Bd - Sheet1.csv"))
ns_ml_pw_bd <- read.csv(here("data", "nine-sites-PW-on-MLBd - Sheet1.csv")) %>% 
  filter(site != "NORTH")

#---- Part III
ns_ml_pw_bd$site <- factor(ns_ml_pw_bd$site,
                                levels = c("CABIN", "GRAMPS", "WEST", "GDPND005", "GDPND006", "GDPND009", "PRPND004", "PRPND009", "PRPND010", "control"))
ns_ml_pw_bd$bd_location <- factor(ns_ml_pw_bd$bd_location, levels = c("supernatant", "adherent"))
ns_ml_pw_bd$day <- factor(ns_ml_pw_bd$day, levels = c("1", "7"), 
                            labels = c("Day_1", "Day_7")) 

# Step 1: combine supernatant and adherent
ns_ml_wider_combined <- ns_ml_pw_bd %>%
  pivot_wider(names_from = bd_location, values_from = bd_qty) %>%
  mutate(combined_bd = adherent + supernatant)

ns_ml_wider_combined <- subset(ns_ml_wider_combined, select = -c(adherent,supernatant) )

ns_ml_wider_combined <- ns_ml_wider_combined %>% 
  # calculate diff
  pivot_wider(names_from = day, values_from = combined_bd) %>%
  mutate(diff = Day_1 - Day_7)

# Step 2: create subsets for each treatment
ns_ml_wider_combined_40um <- ns_ml_wider_combined %>% 
  filter(filter =="40um_filter")
ns_ml_wider_combined_.22um <- ns_ml_wider_combined %>% 
  filter(filter =="0.22um_filter")

### Make df of control
partI_controls2 <- partI_controls %>% 
  pivot_wider(names_from = bd_location, values_from = bd_qty) %>%
  mutate(combined_bd = adherent + floating)

```

# Part I: Effect of aquatic environmental microbes on Bd growth - 15 sites

## PI About the data

Wrangled results file name: ["fifteen-sites-PW-on-Bd.csv"](https://docs.google.com/spreadsheets/d/11pCxR2oeprag1EGEAtdYpSmjaPwXD9szq_029p4OB2Q/edit?usp=sharing)

File source: "[Biofilm PCR for R-studio](https://docs.google.com/spreadsheets/d/17QveSH4al14axf-cBsu4JEhgampQEU1E/edit?usp=sharing&ouid=116930126837996341679&rtpof=true&sd=true)" first tab called 15 sites PW on Bd

Statistical question:

Is there a difference in the **gain or loss of Bd over 7 days** between the **filter sizes** looking at the **TOTAL BD**

**Answer: There is a significant difference in the change in the total quantity of Bd from Day 1 to Day 7 across the filter types (t = 4.7879, df = 14, p-value = 0.000289)**

## PI data wrangling

```{r}
# remove controls
partI <- fs_pw_bd %>% filter(site != "sterile MQ")

# keep control for labeling plot
partI_controls <- fs_pw_bd %>% 
  filter(site =="sterile MQ")

# data type cleaning
partI$bd_location <- factor(partI$bd_location, levels = c("floating", "adherent"))
partI$filter <- factor(partI$filter,
                          levels = c("40um_filter", "0.22um_filter"))
partI$day <- factor(partI$day, levels = c("1", "7"),
                            labels = c("Day_1", "Day_7"))
partI$site <- factor(partI$site,
                          levels = c("BARN", "CABIN", "NORTH", "GRAMPS", "WEST", "GDPND004", "GDPND005", "GDPND006", "GDPND008", "GDPND009", "PRPND002", "PRPND003", "PRPND004", "PRPND009", "PRPND010", "sterile MQ"))

partI_total_diff <- partI %>%
  # combine floating and adherent for total_Bd
  pivot_wider(names_from = bd_location, values_from = bd_qty) %>%
  mutate(combined_bd = adherent + floating) %>% 
  subset(select = -c(adherent,floating)) %>% 
# calculate the difference in raw amount of Bd
  pivot_wider(names_from = day, values_from = combined_bd) %>%
  mutate(diff = Day_1 - Day_7) %>% 
# calculate the rate loss by taking the log of each before subtracting
  mutate(rate_loss = log(Day_1) - log(Day_7))

```


## PI Data visualization

```{r}
# Colors: these are from Paul Tol's colorblind friendly palette
with_microbes <- "#999933"
no_microbes <- "#88ccee"

my_palette <- c("40um_filter" = "#999933","0.22um_filter" = "#88ccee")
```


### Renwei barplot remake

```{r}
partI %>%
  # combine floating and adherent for total_Bd
  pivot_wider(names_from = bd_location, values_from = bd_qty) %>%
  mutate(combined_bd = adherent + floating) %>% 
ggplot(aes(y= combined_bd, x = site, fill = filter)) + 
    geom_col(position = position_dodge()) +
  scale_y_log10() +
    facet_wrap(~day, labeller = labeller(day = c("Day_1" = "Day 1",
                                                    "Day_7" = "Day 7")))+
  scale_fill_manual(values = my_palette) +
    theme_classic() +
   theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
         strip.text = element_text(face="bold"),
         axis.title = element_text(face = "bold")) + 
    xlab("Site") +
    ylab("Bd Quantity \n (zoospore equivalents)") +
  guides(fill=guide_legend(title=""))
```
## Boxplot

```{r}
partI %>%
  # combine floating and adherent for total_Bd
  pivot_wider(names_from = bd_location, values_from = bd_qty) %>%
  mutate(combined_bd = adherent + floating) %>% 
ggplot(aes(y= combined_bd, x = filter, fill = filter)) + 
    geom_boxplot() +
  geom_jitter(width = 0.2, alpha = 0.3) +
    scale_y_log10() +
    facet_wrap(~day, labeller = labeller(day = c("Day_1" = "Day 1",
                                                    "Day_7" = "Day 7")))+
  scale_fill_manual(values = my_palette) +
    theme_classic() +
   theme(legend.position = "none",
         strip.text = element_text(face="bold"),
         axis.title = element_text(face = "bold")) + 
  scale_x_discrete (labels= c("40um_filter" = "With Microbes", "0.22um_filter" = "No Microbes")) +
    xlab("Presence of Microbes in Pond Water") +
    ylab("Bd Quantity \n (zoospore equivalents)") 

# add x's for controls

```

# visualize the diff

```{r}
partI_total_diff %>%
ggplot(aes(y= diff, x = filter, fill = filter)) + 
    geom_boxplot() +
    scale_y_log10() +
  scale_fill_manual(values = c(with_microbes, no_microbes), labels=c('Pond water with microbes', 'Pond water without microbes')) +
    theme_classic() +
   theme(legend.position = "none",
         strip.text = element_text(face="bold"),
         axis.title = element_text(face = "bold")) + 
  scale_x_discrete (labels= c("40um_filter" = "With Microbes", "0.22um_filter" = "No Microbes")) +
    xlab("Presence of Microbes in Pond Water") +
    ylab("Bd Loss \n (Quantity of zoospore equivalents lost over 7 days)") 
```


## PI Stats and assumption testing

Question:

Does the difference in Bd from day 1 to day 7 differ between the two filter types?

The samples are essentially paired by site, so a paired t-test is most appropriate

$H0:Î¼_{difference in Bd}=0$

Assumptions:

Assumes that the observations from each group represent a random sample from the population. Assumes that the difference of the two observations follow a normal distribution.

### Part I Q1: Paired t-test on the difference in all of the Bd from day 1 to day 7 between the two filters

**There is a significant difference in the change in the total quantity of Bd from Day 1 to Day 7 across the filter types (t = 4.7879, df = 14, p-value = 0.000289)**

```{r}
# first, split into 2 data frames one for 40 and one for .22

partI_total_diff_40um <- partI_total_diff %>% 
  filter(filter =="40um_filter")
partI_total_diff.22um <- partI_total_diff%>% 
  filter(filter =="0.22um_filter")

# check normality of the differences across groups: it's normal untransformed in both!
partI_total_diff_40um %>% 
 ggqqplot("diff", title = "Untransformed Bd in both floating and floating diff between day 1 and 7 qqPlot") # good enough
shapiro.test(partI_total_diff_40um$diff) # normal, yay!
hist(partI_total_diff_40um$diff) # good enough

partI_total_diff.22um%>% 
 ggqqplot("diff", title = "Untransformed Bd in both floating and floating diff between day 1 and 7 qqPlot") # gorgeous
shapiro.test(partI_total_diff.22um$diff) # normal, yay!
hist(partI_total_diff.22um$diff) # good enough

# visualize the comparison I am making
partI_total_diff %>%
ggplot(aes(y= diff, x = filter)) + 
    geom_boxplot() +
  geom_jitter() +
  ggtitle("Visualizing comparison for paired t-test on the differences")
  
```

Stats: 

```{r}
# Step 3: run the paired t-test on the difference
t.test(partI_total_diff_40um$diff, partI_total_diff.22um$diff, paired = TRUE)
```

Pond water with microbes has a significantly greater loss of Bd between day 1 to day 7 than pond water without microbes (t = 4.8, df = 14, p = 0.000289). The t-value is positive, which shows that the first item entered (with microbes) has a larger loss of Bd than the second item entered (no microbes.)


# Part II: Effect of the aquatic environmental biofilm on Bd growth - "9 sites"

## PII About the Data

Wrangled results file name: ["nine-sites-biofilm-on-Bd.csv"](https://docs.google.com/spreadsheets/d/1YCU_tCge48MhDw7cMfYAZYokpwAVHtkaY7rfrC5jUDg/edit#gid=0)

File source: "[Biofilm PCR for R-studio](https://docs.google.com/spreadsheets/d/17QveSH4al14axf-cBsu4JEhgampQEU1E/edit?usp=sharing&ouid=116930126837996341679&rtpof=true&sd=true)" first tab called 9 sites Biofilm on Bd

Statistical question: Is there a difference in Bd quantity in the biofilm between day 0, 1, 7?

## PII Data Wrangling

```{r}
part_two <- ns_biofilm_bd

#---- Part II
part_two$site <- factor(part_two$site,
                                levels = c("CABIN", "GRAMPS", "WEST", "GDPND005", "GDPND006", "GDPND009", "PRPND004", "PRPND009", "PRPND010"))
part_two$bd_location <- factor(part_two$bd_location, levels = c("supernatant", "biofilm"))
part_two$day <- factor(part_two$day, levels = c("Day_0", "Day_1", "Day_7")) 

part_two_bf_only <- part_two %>% 
  filter(bd_location == "biofilm")

```


## PII Data Visualization

### Renwei barplot

```{r}
part_two %>%
ggplot(aes(y= bd_qty, x = site, fill=bd_location)) + 
    geom_col() +
    facet_grid(.~day)+
  theme_classic()+
  scale_fill_manual(values = c("lightgrey", "gray45" )) +
    theme(axis.text.x = element_text(angle = 90),
          legend.position = "bottom") + 
    scale_y_log10() +
    xlab("Site") +
   ylab("Total Bd Quantity Per Well \n (zoospore equivalents)") 
```
## Boxplot

```{r}
part_two_bf_only %>%
ggplot(aes(y= bd_qty, x = day)) + 
    geom_boxplot(fill = "lightgrey") +
    theme_classic() +
  scale_y_log10() +
   theme(legend.position = "none",
         strip.text = element_text(face="bold"),
         axis.title = element_text(face = "bold")) + 
    xlab("Time (days)") +
    ylab("Bd Quantity \n (zoospore equivalents)") +
  ggtitle("Amount of Bd in field-collected biofilm over time")
```

## PII Assumptions testing and Stats

```{r}

```


Mix-effects model 

Outcome variable: amount of Bd
Fixed effect: day
Random effect: site

### lme time using nlme
```{r}
# wrangle
part_two_bf_only  <- part_two_bf_only  %>% 
  mutate(log_qty = log(bd_qty))

# visualize
psych::pairs.panels(part_two_bf_only)
part_two_bf_only %>%
 ggqqplot("log_qty", title = "Day_0") # good enough?
  shapiro.test(part_two_bf_only$log_qty) # normal, yay!
  hist(part_two_bf_only$log_qty) # good enough?

# Model for randomized block design
lme_mod <- lme(log_qty ~ day, random = ~1|factor(site),  data = part_two_bf_only)
summary(lme_mod) # summary of the output
anova(lme_mod) # suse anova table to determine if the fixed effect of day is significant

emmeans::emmeans(lme_mod, pairwise ~ day) # pairwise comparisons

```


# Part III: Effect of microbes in pond water on the Bd-release from mono-strain Bd biofilm - "9 sites" and included biofilm

## PIII About the data

Wrangled results file name: ["nine-sites-PW-on-MLBd.csv"](https://docs.google.com/spreadsheets/d/1I2Y4uf3rP3__Y2p3JLrsTD_9PBUNBYgjY7XG1uOidYA/edit?usp=sharing)

File source: "[Biofilm PCR for R-studio](https://docs.google.com/spreadsheets/d/17QveSH4al14axf-cBsu4JEhgampQEU1E/edit?usp=sharing&ouid=116930126837996341679&rtpof=true&sd=true)" tab called 9 sites PW on MLBd

### Statistical question:

Scientific Q: Is mono-strain Bd biofilm resistant to microbes in pond water

Statistical question:

Is there a difference in the **gain or loss of Bd total over 7 days** between the **filter sizes**?

**There is a significant difference in the change in the total quantity of Bd from Day 1 to Day 7 across the filter types (t = -6.45, df = 7, p-value = 0.0003)**

## Renwei barplot

```{r}
with_microbes <- "#3c3c3c"
no_microbes <- "#888888"

ns_ml_pw_bd %>% 
  pivot_wider(names_from = bd_location, values_from = bd_qty) %>%
  mutate(combined_bd = adherent + supernatant) %>% 
ggplot(aes(y= log10(combined_bd), x = site, fill = filter)) + 
    geom_col(position = position_dodge()) +
    facet_wrap(~day, labeller = labeller(day = c("Day_1" = "Day 1",
                                                    "Day_7" = "Day 7")))+
 # scale_fill_manual(values = c(with_microbes, no_microbes), labels=c('Pond water with microbes', 'Pond water without microbes')) +
    theme_classic() +
   theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
         strip.text = element_text(face="bold"),
         axis.title = element_text(face = "bold")) + 
    xlab("Site") +
    ylab("Bd Quantity \n (log transformed zoospore equivalents)") +
  guides(fill=guide_legend(title="")) +
  ggtitle("Mono-layer Bd Biofilm exposed to pond water") 

# Colors
# can try fun colors suggested: these are from Paul Tol's colorblind friendly palette
with_microbes <- "#999933"
no_microbes <- "#88ccee"

ns_ml_pw_bd %>% 
  pivot_wider(names_from = bd_location, values_from = bd_qty) %>%
  mutate(combined_bd = adherent + supernatant) %>% 
ggplot(aes(y= log10(combined_bd), x = site, fill = filter)) + 
    geom_col(position = position_dodge()) +
    facet_wrap(~day, labeller = labeller(day = c("Day_1" = "Day 1",
                                                    "Day_7" = "Day 7")))+
  #scale_fill_manual(values = c(with_microbes, no_microbes), labels=c('Pond water with microbes', 'Pond water without microbes')) +
    theme_classic() +
   theme(axis.text.x = element_text(angle = 90),
        legend.position = "bottom",
         strip.text = element_text(face="bold"),
         axis.title = element_text(face = "bold")) + 
    xlab("Site") +
    ylab("Bd Quantity \n (log transformed zoospore equivalents)") +
  guides(fill=guide_legend(title="")) +
  ggtitle("Mono-layer Bd Biofilm exposed to pond water") 
```

## Boxplot

```{r}
with_microbes <- "#3c3c3c"
no_microbes <- "#888888"

ns_ml_pw_bd %>%
  pivot_wider(names_from = bd_location, values_from = bd_qty) %>%
  mutate(combined_bd = adherent + supernatant) %>% 

ggplot(aes(y= log10(combined_bd), x = filter, fill = filter)) + 
    geom_boxplot() +
    facet_wrap(~day, labeller = labeller(day = c("Day_1" = "Day 1",
                                                    "Day_7" = "Day 7")))+
 # scale_fill_manual(values = c(with_microbes, no_microbes), labels=c('Pond water with microbes', 'Pond water without microbes')) +
    theme_classic() +
   theme(legend.position = "none",
         strip.text = element_text(face="bold"),
         axis.title = element_text(face = "bold")) + 
  scale_x_discrete (labels= c("40um_filter" = "With Microbes", "0.22um_filter" = "No Microbes")) +
    xlab("Presence of Microbes in Pond Water") +
    ylab("Bd Quantity \n (log transformed zoospore equivalents)") +
  ggtitle("Mono-layer Bd Biofilm exposed to pond water") 

# can try fun colors suggested: these are from Paul Tol's colorblind friendly palette
with_microbes <- "#999933"
no_microbes <- "#88ccee"

ns_ml_pw_bd %>%
   pivot_wider(names_from = bd_location, values_from = bd_qty) %>%
 mutate(combined_bd = adherent + supernatant) %>% 
ggplot(aes(y= log10(combined_bd), x = filter, fill = filter)) + 
    geom_boxplot() +
    facet_wrap(~day, labeller = labeller(day = c("Day_1" = "Day 1",
                                                    "Day_7" = "Day 7")))+
 # scale_fill_manual(values = c(with_microbes, no_microbes), labels=c('Pond water with microbes', 'Pond water without microbes')) +
    theme_classic() +
   theme(legend.position = "none",
         strip.text = element_text(face="bold"),
         axis.title = element_text(face = "bold")) + 
  scale_x_discrete (labels= c("40um_filter" = "With Microbes", "0.22um_filter" = "No Microbes")) +
    xlab("Presence of Microbes in Pond Water") +
    ylab("Bd Quantity \n (log transformed zoospore equivalents)") +
  ggtitle("Mono-layer Bd Biofilm exposed to pond water") 
```

## Scatterplot

```{r}
with_microbes <- "#999933"
no_microbes <- "#88ccee"

ns_ml_wider_combined %>% 
  ggplot(aes(x = log10(Day_7), y = log10(Day_1), color = filter)) +
  geom_point() +
   scale_color_manual(values = c(with_microbes, no_microbes), labels=c('Pond water with microbes', 'Pond water without microbes')) +
    theme_classic() +
   theme(legend.position = "bottom",
         strip.text = element_text(face="bold"),
         axis.title = element_text(face = "bold")) + 
    xlab("Bd Quantity Day 7 \n (log transformed zoospore equivalents)") +
    ylab("Bd Quantity Day 1 \n (log transformed zoospore equivalents)") +
  guides(fill=guide_legend(title=""))
  
```

## PIII Stats and assumption testing

Question:

Does the difference in Bd from day 1 to day 7 differ between the two filter types?

The samples are essentially paired by site, so a paired t-test is most appropriate

$H0:Î¼_{difference in Bd}=0$

Assumptions:

Assumes that the observations from each group represent a random sample from the population. Assumes that the difference of the two observations follow a normal distribution.

```{r}
# Assumptions testing

# check normality of the differences across groups
ns_ml_wider_combined_40um %>% 
 ggqqplot("diff", title = "40 um") # not great
shapiro.test(ns_ml_wider_combined_40um$diff) # NOT normal
hist(ns_ml_wider_combined_40um$diff) # nope

# we gotta transform, but we have negative: west GAINED Bd
ns_ml_wider_combined_40um <- ns_ml_wider_combined_40um %>% 
  mutate(log_diff = log(diff))

ns_ml_wider_combined_40um %>% 
  ggqqplot("log_diff", title = "40 um") # good enough
shapiro.test(ns_ml_wider_combined_40um$log_diff) # woohoo!!
hist(ns_ml_wider_combined_40um$log_diff) # sure

# 0.22 micron

# check normality of the differences across groups
ns_ml_wider_combined_.22um %>% 
 ggqqplot("diff", title = ".22 um") # not great
shapiro.test(ns_ml_wider_combined_.22um$diff) # shapiro says its fine
hist(ns_ml_wider_combined_.22um$diff) # meh

# we gotta transform, but we have negative: west GAINED Bd
ns_ml_wider_combined_.22um <- ns_ml_wider_combined_.22um %>% 
  mutate(log_diff = log(diff))

ns_ml_wider_combined_.22um %>% 
  ggqqplot("log_diff", title = ".22 um") # better?
shapiro.test(ns_ml_wider_combined_.22um$log_diff) # woohoo!!
hist(ns_ml_wider_combined_.22um$log_diff) # sure
  
```

Stats: 

```{r}
# Step 3: run the paired t-test on the difference
t.test(ns_ml_wider_combined_40um$log_diff, ns_ml_wider_combined_.22um$log_diff, paired = TRUE)
```
# Part IV Monolayer vs Water

Part IV: Part 1 vs part 3
- 1: susbet out only nine sites
- 2: calculate the percent Bd lost from day 1 to day 7 per site
- 3: add column for field biofilm or no biofilm
- 4: diff ~ type
- Or just plot them

```{r}
# data wrangling for comparisons across experiments

part1 <- fs_wider_combined %>% 
  filter(site!="NORTH" & site!="BARN" & site!="PRPND002"  & site!="PRPND003" & site!="GDPND004"  & site!="GDPND008") %>% 
  mutate(expt = "pond_water")

pw_no_microbes <- part1 %>% 
  filter(filter == "0.22um_filter") %>% 
  mutate(treatment = "PW 0.22um")

pw_microbes <- part1 %>% 
  filter(filter != "0.22um_filter") %>% 
  mutate(treatment = "PW 40um")

part2 <- ns_biofilm_wider_combined %>% 
  mutate(expt = "field_bd_biofilm") %>% 
  mutate(filter = "0.22um_filter")

fieldbf_no_microbes <- part2 %>% 
  filter(filter == "0.22um_filter") %>% 
  mutate(treatment = "Field bf 0.22")

part3 <- ns_ml_wider_combined %>% 
  mutate(expt = "monolayer_bd_biofilm") 

monolayer_no_microbes <- part3 %>% 
  filter(filter == "0.22um_filter") %>% 
  mutate(treatment = "Monolayer 40um")

monolayer_with_microbes <- part3 %>% 
  filter(filter != "0.22um_filter") %>% 
  mutate(treatment = "Monolayer 0.22um")
  
all_parts<- bind_rows(pw_no_microbes, pw_microbes, fieldbf_no_microbes, monolayer_no_microbes, monolayer_with_microbes ) %>% 
  mutate(percent_loss = (diff/Day_1) * 100) 

# set PW 40 um as the intercept, comparing back to that one
all_parts$treatment <- factor(all_parts$treatment ,
                          levels = c("PW 40um","PW 0.22um","Field bf 0.22","Monolayer 40um","Monolayer 0.22um"))
  
```

## Boxplot of all parts

```{r}
all_parts %>% 
  ggplot(aes(y= percent_loss, x = treatment)) + 
    geom_boxplot() +
  geom_jitter(alpha = 0.5, width = 0.1) +
  scale_fill_manual(values = c(with_microbes, no_microbes), labels=c('Pond water with microbes', 'Pond water without microbes')) +
    theme_classic() +
   theme(legend.position = "none",
         strip.text = element_text(face="bold"),
         axis.title = element_text(face = "bold")) + 
  scale_x_discrete (labels= c("40um_filter" = "With Microbes", "0.22um_filter" = "No Microbes")) +
    xlab("Treatment") +
    ylab("Percent Reduction of Bd over 7 Days") +
  ggtitle("Which treatments are we comparing?") 
```

## throw it all in a mixed model?

```{r}
lme_mod <- lme(percent_loss ~ treatment, random = ~1|factor(site),  data = all_parts)
lme_mod # "print" the output
summary(lme_mod) # summary of the output
anova(lme_mod)

emmeans::emmeans(lme_mod, pairwise ~ treatment)

```
## "Option A" Look at just PW microbes vs monolayer with microbes

```{r}
sub1 <- all_parts %>% 
  filter(treatment == "PW 40um" | treatment == "Monolayer 40um")

lme_mod <- lme(percent_loss ~ treatment, random = ~1|factor(site),  data = sub1)
lme_mod # "print" the output
summary(lme_mod) # summary of the output, there's a diff

#alternatively, pairwise t.test
treat1 <- sub1 %>% 
  filter(treatment == "PW 40um")
treat2 <- sub1 %>% 
  filter(treatment != "PW 40um")

t.test(treat1$percent_loss, treat2$percent_loss, paired = TRUE) # there's a difference

# quick vis of comparison
sub1 %>% 
  ggplot(aes(y= percent_loss, x = treatment)) + 
    geom_boxplot()
```

## "Option B" Look at just PW microbes vs monolayer without microbes

```{r}
sub1 <- all_parts %>% 
  filter(treatment == "PW 40um" | treatment == "Monolayer 0.22um")

lme_mod <- lme(percent_loss ~ treatment, random = ~1|factor(site),  data = sub1)
lme_mod # "print" the output
summary(lme_mod) # summary of the output, there's a diff

#alternatively, pairwise t.test
treat1 <- sub1 %>% 
  filter(treatment == "PW 40um")
treat2 <- sub1 %>% 
  filter(treatment != "PW 40um")

t.test(treat1$percent_loss, treat2$percent_loss, paired = TRUE) # there's a difference

# quick vis of comparison
sub1 %>% 
  ggplot(aes(y= percent_loss, x = treatment)) + 
    geom_boxplot()
```


## Option 2A: Field biofilm with no microbes vs pond water microbes (biofim OR microbes)

```{r}
sub1 <- all_parts %>% 
  filter(treatment == "PW 40um" | treatment == "Field bf 0.22")

lme_mod <- lme(percent_loss ~ treatment, random = ~1|factor(site),  data = sub1)
lme_mod # "print" the output
summary(lme_mod) # summary of the output, no diff
anova(lme_mod) # significant effect of day

#alternatively, pairwise t.test
treat1 <- sub1 %>% 
  filter(treatment == "PW 40um")
treat2 <- sub1 %>% 
  filter(treatment != "PW 40um")

t.test(treat1$percent_loss, treat2$percent_loss, paired = TRUE) # no

sub1 %>% 
  ggplot(aes(y= percent_loss, x = treatment)) + 
    geom_boxplot()
```

## Option 2B: Field biofilm with no microbes vs pond water no microbes 

```{r}
sub1 <- all_parts %>% 
  filter(treatment == "PW 0.22um" | treatment == "Field bf 0.22")

lme_mod <- lme(percent_loss ~ treatment, random = ~1|factor(site),  data = sub1)
lme_mod # "print" the output
summary(lme_mod) # summary of the output, no diff
anova(lme_mod) # significant effect of day

#alternatively, pairwise t.test
treat1 <- sub1 %>% 
  filter(treatment == "PW 0.22um")
treat2 <- sub1 %>% 
  filter(treatment != "PW 0.22um")

t.test(treat1$percent_loss, treat2$percent_loss, paired = TRUE) # yes

sub1 %>% 
  ggplot(aes(y= percent_loss, x = treatment)) + 
    geom_boxplot()
```

# Controls and MISC

```{r}
partI_controls2 %>% 
  ggplot(aes(y= combined_bd, x = filter)) + 
    geom_point(shape = 4, size = 5) +
    facet_wrap(~day, labeller = labeller(day = c("1" = "Day 1",
                                                    "7" = "Day 7")))+
  scale_y_log10() +
   theme(legend.position = "none",
         strip.text = element_text(face="bold"),
         axis.title = element_text(face = "bold")) + 
  scale_x_discrete (labels= c("40um_filter" = "With Microbes", "0.22um_filter" = "No Microbes")) +
    xlab("Presence of Microbes in Pond Water") +
    ylab("Bd Quantity \n (log transformed zoospore equivalents)")
```


